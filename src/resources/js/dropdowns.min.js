var tribe_dropdowns=tribe_dropdowns||{};!function(e,t,a){"use strict";function r(t,a){if(!e.isArray(a))return!1;for(var s in a){var o=a[s];if(o.hasOwnProperty("id")&&o.id==t.id)return o;if(o.hasOwnProperty("text")&&o.text==t.text)return o;if(o.hasOwnProperty("children")&&e.isArray(o.children)){var i=r(t,o.children);if(i)return i}}return!1}t.selector={dropdown:".tribe-dropdown",created:".tribe-dropdown-created"},e.fn.tribe_dropdowns=function(){return t.dropdown(this),this},t.freefrom_create_search_choice=function(e){var t=this.options.options,r=e.term,s=t.$select;if(r.match(t.regexToken)&&(!s.is("[data-int]")||s.is("[data-int]")&&r.match(/\d+/))){var o={id:r,text:r,"new":!0};return s.is("[data-create-choice-template]")&&(o.text=a.template(s.data("createChoiceTemplate"))({term:r})),s.trigger("change"),o}},t.allow_html_markup=function(e){return e},t.search_id=function(e){var t=void 0;return"undefined"!=typeof e.id?t=e.id:"undefined"!=typeof e.ID?t=e.ID:"undefined"!=typeof e.value&&(t=e.value),void 0===e?void 0:t},t.init_selection=function(t,a){var s=t.is("[multiple]"),o=t.data("dropdown"),i=t.val().split(o.regexSplit),n=[];e(i).each(function(e,a){var s={id:this,text:this},i=o.ajax?t.data("options"):o.data,d=r(s,i);d&&n.push(d)}),n.length&&s?a(n):n.length&&a(n[0])},t.element=function(r,s){var o,i=e(r),s=e.extend({},s),n=i.attr("class");if(i.addClass(t.selector.created.className()),s.$select=i,s.dropdownAutoWidth=!0,s.containerCss={},i.is(":visible")&&(s.containerCss.display="inline-block",s.containerCss.position="relative"),s.dropdownCss={},s.dropdownCss.width="auto",i.is("[data-dropdown-css-width]")&&(s.dropdownCss.width=i.data("dropdown-css-width"),s.dropdownCss.width||delete s.dropdownCss.width),i.is("select")||(s.id=t.search_id),s.allowClear=!0,i.is("[data-prevent-clear]")&&(s.allowClear=!1),i.is("[data-searching-placeholder]")&&(s.formatSearching=i.data("searching-placeholder")),i.is("[data-options]")&&(s.data=i.data("options"),i.is("select")||(s.initSelection=t.init_selection)),i.is("[data-allow-html]")&&(s.escapeMarkup=t.allow_html_markup),i.is("[data-hide-search]")&&(s.minimumResultsForSearch=1/0),i.is("[data-freeform]")&&(s.createTag=t.freefrom_create_search_choice,s.tags=!0),i.is("[multiple]")&&(s.multiple=!0,i.is("[data-maximum-selection-size]")&&(s.maximumSelectionSize=i.data("maximum-selection-size")),i.is("data-separator")||i.data("separator",","),a.isArray(i.data("separator"))?s.tokenSeparators=i.data("separator"):s.tokenSeparators=[i.data("separator")],s.separator=i.data("separator"),s.regexSeparatorElements=["^("],s.regexSplitElements=["(?:"],e.each(s.tokenSeparators,function(e,t){s.regexSeparatorElements.push("[^"+t+"]+"),s.regexSplitElements.push("["+t+"]")}),s.regexSeparatorElements.push(")$"),s.regexSplitElements.push(")"),s.regexSeparatorString=s.regexSeparatorElements.join(""),s.regexSplitString=s.regexSplitElements.join(""),s.regexToken=new RegExp(s.regexSeparatorString,"ig"),s.regexSplit=new RegExp(s.regexSplitString,"ig")),i.is("[data-tags]")&&(s.tags=i.data("tags"),s.initSelection=t.init_selection,s.createSearchChoice=function(e,t){if(e.match(s.regexToken))return{id:e,text:e}},0===s.tags.length&&(s.formatNoMatches=function(){return i.attr("placeholder")})),i.is("[data-source]")){var d=i.data("source");s.data={results:[]},s.escapeMarkup=t.allow_html_markup,s.formatResult=function(t,a,r){return"undefined"!=typeof t.breadcrumbs?e.merge(t.breadcrumbs,[t.text]).join(" &#187; "):t.text},s.ajax={dataType:"json",type:"POST",url:t.ajaxurl(),processResults:function(t,a,r){return e.isPlainObject(t)&&"undefined"!=typeof t.success?e.isPlainObject(t.data)&&"undefined"!=typeof t.data.results?t.success?t.data:("string"===e.type(t.data.message)?console.error(t.data.message):console.error("The Select2 search failed in some way... Verify the source."),{results:[]}):(console.error("We received a malformed results array, could not complete the Select2 Search."),{results:[]}):(console.error("We received a malformed Object, could not complete the Select2 Search."),{results:[]})}},s.ajax.data=function(e,t){return{action:"tribe_dropdown",source:d,search:e,page:t,args:i.data("source-args")}}}i.data("dropdown",s),o=i.select2(s),o.data("select2").$container.addClass(n),o.data("select2").$container.removeClass("hide-before-select2-init")},t.action_change=function(t){var r=e(this),s=e(this).data("value");r.is("[multiple]")&&r.is("[data-source]")&&(t.added?a.isArray(s)?s.push(t.added):s=[t.added]:s=a.isArray(s)?a.without(s,t.removed):[],r.data("value",s).attr("data-value",JSON.stringify(s)))},t.ajaxurl=function(){return"undefined"!=typeof window.ajaxurl?window.ajaxurl:"undefined"!=typeof TEC&&"undefined"!=typeof TEC.ajaxurl?TEC.ajaxurl:void console.error("Dropdowns framework cannot properly do an AJAX request without the WordPress `ajaxurl` variable setup.")},t.action_select2_removed=function(t){var a=e(this);a.is("[data-sticky-search]")&&a.is("[data-last-search]")&&a.removeAttr("data-last-search").removeData("lastSearch")},t.action_bugfix_group_select=function(a){var r=e(this),s=r.select2("data"),o=e(".select2-drop:visible");o.find(".select2-selected").each(function(){var a=e(this),r=a.data("select2-data"),o=!0;"undefined"!=typeof r.children&&(e.each(s,function(e,a){t.search_id(r)==t.search_id(a)&&(o=!1)}),o&&a.removeClass("select2-selected"))})},t.action_select2_close=function(t){var a=e(this),r=e(".select2-drop .select2-input.select2-focused");a.is("[data-sticky-search]")&&r.off("keyup-change.tribe")},t.action_select2_open=function(t){var a=e(this),r=e(".select2-drop .select2-input:visible");a.is("[data-search-placeholder]")&&r.attr("placeholder",a.data("searchPlaceholder")),a.is("[data-sticky-search]")&&(r.on("keyup-change.tribe",function(){a.data("lastSearch",e(this).val()).attr("data-last-search",e(this).val())}),a.is("[data-last-search]")&&r.val(a.data("lastSearch")).trigger("keyup-change"))},t.dropdown=function(e,a){var r=e.not(".select2-offscreen, .select2-container, "+t.selector.created.className());return 0===r.length?r:(a||(a={}),r.each(function(e,r){t.element(r,a)}).on("select2-open",t.action_select2_open).on("select2-close",t.action_select2_close).on("select2-removed",t.action_select2_removed).on("select2-loaded",t.action_bugfix_group_select).on("change",t.action_change),r)},e(function(){e(t.selector.dropdown).tribe_dropdowns()}),e(window).on("unload",function(){e(t.selector.dropdown).tribe_dropdowns()})}(jQuery,tribe_dropdowns,window.underscore||window._);